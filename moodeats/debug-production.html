<!DOCTYPE html>
<html>
<head>
    <title>Debug Production Site</title>
</head>
<body>
    <h1>Debug MoodEats Production Site</h1>
    <iframe id="moodeats" src="https://njrun1804.github.io/moodeats/moodeats-planner.html" width="100%" height="600"></iframe>

    <div id="debug">
        <h2>Debug Info:</h2>
        <button onclick="checkState()">Check State</button>
        <button onclick="forceInit()">Force Initialize</button>
        <button onclick="testButton()">Test Browse Tab</button>
        <pre id="output"></pre>
    </div>

    <script>
        const output = document.getElementById('output');

        function log(msg) {
            output.textContent += msg + '\n';
        }

        function checkState() {
            const iframe = document.getElementById('moodeats');
            const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
            const iframeWin = iframe.contentWindow;

            log('=== State Check ===');
            log('window.meals: ' + (iframeWin.meals ? iframeWin.meals.length + ' meals' : 'undefined'));
            log('window.embeddedMeals: ' + (iframeWin.embeddedMeals ? iframeWin.embeddedMeals.length + ' meals' : 'undefined'));
            log('window.initializeApp: ' + typeof iframeWin.initializeApp);
            log('window.setupAllEventListeners: ' + typeof iframeWin.setupAllEventListeners);

            // Check if browse tab has click handler
            const browseTab = iframeDoc.getElementById('browseTab');
            if (browseTab) {
                log('browseTab found: ' + browseTab.className);
                // Try clicking it
                browseTab.click();
                setTimeout(() => {
                    const browseView = iframeDoc.getElementById('browseView');
                    log('After click - browseView classes: ' + browseView?.className);
                }, 500);
            }
        }

        function forceInit() {
            const iframe = document.getElementById('moodeats');
            const iframeWin = iframe.contentWindow;

            log('=== Force Initialize ===');
            if (typeof iframeWin.initializeApp === 'function') {
                iframeWin.initializeApp();
                log('Called initializeApp()');

                setTimeout(() => {
                    log('After init - meals: ' + (iframeWin.meals ? iframeWin.meals.length : 'undefined'));
                }, 1000);
            } else {
                log('initializeApp not found!');
            }
        }

        function testButton() {
            const iframe = document.getElementById('moodeats');
            const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;

            log('=== Test Browse Tab ===');
            const browseTab = iframeDoc.getElementById('browseTab');
            const planTab = iframeDoc.getElementById('planTab');
            const browseView = iframeDoc.getElementById('browseView');
            const planView = iframeDoc.getElementById('planView');

            log('Before click:');
            log('  browseView: ' + browseView?.className);
            log('  planView: ' + planView?.className);

            browseTab.click();

            setTimeout(() => {
                log('After click:');
                log('  browseView: ' + browseView?.className);
                log('  planView: ' + planView?.className);

                // Try manually toggling
                if (browseView.classList.contains('hidden')) {
                    log('Manually removing hidden from browseView...');
                    browseView.classList.remove('hidden');
                    planView.classList.add('hidden');
                    log('After manual toggle:');
                    log('  browseView: ' + browseView?.className);
                    log('  planView: ' + planView?.className);
                }
            }, 500);
        }

        // Check after iframe loads
        document.getElementById('moodeats').onload = function() {
            log('=== Iframe Loaded ===');
            setTimeout(checkState, 2000);
        };
    </script>
</body>
</html>